

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="pt-br" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="pt-br" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Documentação Rádio c/ Liquidsoap &mdash; radio liquidsoap  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="#" class="icon icon-home"> radio liquidsoap
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Documentação Rádio c/ Liquidsoap</a></li>
<li><a class="reference internal" href="#instalacao">Instalação</a></li>
<li><a class="reference internal" href="#verificacao">Verificação</a></li>
<li><a class="reference internal" href="#testes">Testes</a><ul>
<li><a class="reference internal" href="#geracao-e-teste-porta-8000">Geração e Teste (Porta 8000)</a></li>
<li><a class="reference internal" href="#live">Live</a></li>
</ul>
</li>
<li><a class="reference internal" href="#explicacoes-detalhadas">Explicações Detalhadas</a><ul>
<li><a class="reference internal" href="#iniciando-a-aplicacao">Iniciando a aplicação</a></li>
<li><a class="reference internal" href="#manipulacao-e-execucao-do-projeto">Manipulação e Execução do Projeto</a><ul>
<li><a class="reference internal" href="#executando-liquidsoap">Executando Liquidsoap</a></li>
<li><a class="reference internal" href="#arquivo-xml-de-configuracao-do-liquidsoap">Arquivo XML de configuração do Liquidsoap</a></li>
<li><a class="reference internal" href="#arquivo-xml-de-configuracao-exemplo-icecast2">Arquivo XML de configuração exemplo Icecast2</a></li>
<li><a class="reference internal" href="#arquivo-json-da-playlist">Arquivo JSON da playlist</a></li>
<li><a class="reference internal" href="#scripts-para-manipulacao-da-playlist">Scripts para Manipulação da Playlist</a></li>
</ul>
</li>
<li><a class="reference internal" href="#instalacao-do-liquidsoap-com-encoders">Instalação do Liquidsoap com Encoders</a></li>
<li><a class="reference internal" href="#dependencias-do-servidor">Dependências do Servidor</a></li>
<li><a class="reference internal" href="#script-de-instalacao">Script de Instalação</a></li>
</ul>
</li>
<li><a class="reference internal" href="#observacoes-pertinentes">Observações Pertinentes</a></li>
<li><a class="reference internal" href="#solucoes-conhecidas">Soluções Conhecidas</a><ul>
<li><a class="reference internal" href="#problema-de-leitura-dos-arquivos-xml">Problema de Leitura dos Arquivos XML</a></li>
<li><a class="reference internal" href="#falta-de-memoria-no-servidor-para-instalcao-do-opam">Falta de memória no servidor para instalção do OPAM</a></li>
<li><a class="reference internal" href="#grupo-de-usuario-sem-permissao-no-liquidsoap">Grupo de usuário sem permissão no Liquidsoap</a></li>
<li><a class="reference internal" href="#habilitar-conexao-remota-mysql">Habilitar Conexão Remota MYSQL</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">radio liquidsoap</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>Documentação Rádio c/ Liquidsoap</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="documentacao-radio-c-liquidsoap">
<h1>Documentação Rádio c/ Liquidsoap<a class="headerlink" href="#documentacao-radio-c-liquidsoap" title="Permalink to this headline">¶</a></h1>
<p>Documentação relativa a Rádio implementada com Liquidsoap.
Nesta documentação estão presentes as configurações necessárias
para reinstalar e manipular o projeto em questão.</p>
<div class="toctree-wrapper compound">
</div>
</div>
<div class="section" id="instalacao">
<h1>Instalação<a class="headerlink" href="#instalacao" title="Permalink to this headline">¶</a></h1>
<p><em>Se já houver uma instalação antiga da rádio, execute o seguinte comando antes de prosseguir:</em>
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">rm</span> <span class="pre">-r</span> <span class="pre">/home/streaming/.opam</span></code></p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://gitlab.com/rafaelbaiolim1/liquidsoap.git</span> <span class="pre">-b</span> <span class="pre">install</span> <span class="pre">setup</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">setup</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">./install.sh</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">/var/run/liquidsoap</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">streaming:streaming</span> <span class="pre">/var/run/liquidsoap</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">su</span> <span class="pre">streaming</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">~/.profile</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;create</span> <span class="pre">database</span> <span class="pre">`stream_cast`&quot;</span> <span class="pre">|</span> <span class="pre">mysql</span> <span class="pre">-u</span> <span class="pre">&lt;username&gt;</span> <span class="pre">-p</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/streaming/web/assets/</span> <span class="pre">&amp;&amp;</span> <span class="pre">mysql</span> <span class="pre">-u</span> <span class="pre">&lt;username&gt;</span> <span class="pre">-p</span> <span class="pre">stream_cast</span> <span class="pre">&lt;</span> <span class="pre">locutores.sql&quot;</span></code></li>
</ol>
</div>
<div class="section" id="verificacao">
<h1>Verificação<a class="headerlink" href="#verificacao" title="Permalink to this headline">¶</a></h1>
<p>Antes de prosseguir com os teste, verifique se a pasta <code class="docutils literal notranslate"><span class="pre">/home/streaming/.opam/system</span></code>
foi criada, uma vez que o <code class="docutils literal notranslate"><span class="pre">liquidsoap</span></code> é iniciado a partir do <code class="docutils literal notranslate"><span class="pre">bin</span></code> desta pasta.</p>
</div>
<div class="section" id="testes">
<h1>Testes<a class="headerlink" href="#testes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="geracao-e-teste-porta-8000">
<h2>Geração e Teste (Porta 8000)<a class="headerlink" href="#geracao-e-teste-porta-8000" title="Permalink to this headline">¶</a></h2>
<p>O IP da máquina é associado automaticamente em <code class="docutils literal notranslate"><span class="pre">src.config.generator.php</span></code>.</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/home/streaming</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">php</span> <span class="pre">web/app/utils/src.config.generator.php</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">777</span> <span class="pre">-R</span> <span class="pre">/home/streaming/configs</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">killall</span> <span class="pre">icecast2</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">killall</span> <span class="pre">liquidsoap</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">icecast2</span> <span class="pre">-c</span> <span class="pre">configs/8000.xml</span> <span class="pre">-b</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sh</span> <span class="pre">scripts/ligar_autodj</span> <span class="pre">8000</span> <span class="pre">1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">777</span> <span class="pre">-R</span> <span class="pre">/home/streaming/configs</span></code></li>
</ol>
</div>
<div class="section" id="live">
<h2>Live<a class="headerlink" href="#live" title="Permalink to this headline">¶</a></h2>
<p>Por padrão o script gera a <em>live</em> na porta seguinte <code class="docutils literal notranslate"><span class="pre">(porta</span> <span class="pre">+</span> <span class="pre">1)</span></code>.
<code class="docutils literal notranslate"><span class="pre">Não</span> <span class="pre">é</span> <span class="pre">possível</span> <span class="pre">colocar</span> <span class="pre">a</span> <span class="pre">live</span> <span class="pre">e</span> <span class="pre">a</span> <span class="pre">rádio</span> <span class="pre">na</span> <span class="pre">mesma</span> <span class="pre">porta</span></code>.
As configurações para conexão do <em>DJ</em> na rádio da porta <code class="docutils literal notranslate"><span class="pre">8000</span></code>
pode ser configurada na ferramenta <code class="docutils literal notranslate"><span class="pre">Butt</span></code> como na figura abaixo.</p>
<a class="reference internal image-reference" href="_images/live-example.png"><img alt="Butt Config Live" class="align-center" src="_images/live-example.png" style="width: 200px; height: 280px;" /></a>
<p>Os dados desta autenticação estão na tabela de <code class="docutils literal notranslate"><span class="pre">'locutores'</span> <span class="pre">do</span> <span class="pre">banco</span> <span class="pre">MYSQL</span></code>, importada no passo de instação.
A tabela usada para testes deve conter os seguintes registros para que o <code class="docutils literal notranslate"><span class="pre">brodcast</span></code> da <code class="docutils literal notranslate"><span class="pre">live</span></code> na porta <code class="docutils literal notranslate"><span class="pre">8000</span></code> funcione:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Registro de teste da tabela locutores</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">id</th>
<th class="head">port</th>
<th class="head">mount_point</th>
<th class="head">login</th>
<th class="head">password</th>
<th class="head">schedule_sun</th>
<th class="head">schedule_mon</th>
<th class="head">schedule_tue</th>
<th class="head">schedule_wed</th>
<th class="head">schedule_thu</th>
<th class="head">schedule_fri</th>
<th class="head">schedule_sat</th>
<th class="head">hour_period_start</th>
<th class="head">hour_period_end</th>
<th class="head">timezone</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>8001</td>
<td>live</td>
<td>rafael</td>
<td>81dd408b0131533ffc9dc26a3317ab57c1e20e2d</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>00:01:00</td>
<td>23:59:00</td>
<td>America/Sao_Paulo</td>
</tr>
</tbody>
</table>
<p><em>Note que é necessário que as flags de schedule, bem como os horários de streaming estejam setados para a autenticação ocorrer corretamente</em></p>
</div>
</div>
<div class="section" id="explicacoes-detalhadas">
<h1>Explicações Detalhadas<a class="headerlink" href="#explicacoes-detalhadas" title="Permalink to this headline">¶</a></h1>
<div class="section" id="iniciando-a-aplicacao">
<h2>Iniciando a aplicação<a class="headerlink" href="#iniciando-a-aplicacao" title="Permalink to this headline">¶</a></h2>
<p>A partir do root é possivel inicializar o programa usando o script <cite>ligar_autodj</cite>,
execute .:</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">su</span> <span class="pre">-</span> <span class="pre">streaming</span> <span class="pre">scripts/ligar_autodj</span> <span class="pre">$1</span> <span class="pre">$2</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$1</span> <span class="pre">(parâmetro</span> <span class="pre">obrigatório)</span> <span class="pre">:</span> <span class="pre">porta</span> <span class="pre">icecast2</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$2</span> <span class="pre">(parâmetro</span> <span class="pre">opcional,</span> <span class="pre">executa</span> <span class="pre">a</span> <span class="pre">saída</span> <span class="pre">do</span> <span class="pre">liquidsoap</span> <span class="pre">em</span> <span class="pre">primeiro</span> <span class="pre">plano)</span> <span class="pre">:</span> <span class="pre">TRUE</span></code>
<em>Os logs do liquidsoap estão habilitados para geração em arquivo e por padrão começam desabilitados.
Para ativar os logs veja a secção de configuração do XML do Liquid.</em></p>
</div>
<div class="section" id="manipulacao-e-execucao-do-projeto">
<h2>Manipulação e Execução do Projeto<a class="headerlink" href="#manipulacao-e-execucao-do-projeto" title="Permalink to this headline">¶</a></h2>
<p>A elaboração deste projeto foi adaptada a partir da sua versão inicial, substituindo
a ferramenta ICES por Liquidsoap. Para rodar o autodj é necessário que os seguintes
processos sejam executados.:</p>
<ol class="arabic simple">
<li>Banco MySQL com os dados importados para autenticação das lives.</li>
<li>Icecast2 com sua respectiva config. (Playlist e Live)</li>
<li>Script do Liquidsoap apontando para as config. do Icecast.</li>
</ol>
<p>4. JSON da playlist com o formato que será apresentado. Assim como o caminho dos arquivos de
audio setados corretamente.</p>
<div class="section" id="executando-liquidsoap">
<h3>Executando Liquidsoap<a class="headerlink" href="#executando-liquidsoap" title="Permalink to this headline">¶</a></h3>
<p>Com a ferramenta devidamente instalada, veja a secção <a class="reference internal" href="#instalacao-do-liquidsoap-com-encoders"><span class="std std-ref">Instalação do Liquidsoap com Encoders</span></a>
se necessário, execute o script <code class="docutils literal notranslate"><span class="pre">web/app.dist.liq</span></code> utilizando como parâmetro a porta em que o <cite>icecast2</cite>
está executando Ex.:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">liquidsoap</span> <span class="pre">app.dist.liq</span> <span class="pre">--</span> <span class="pre">$porta</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">--</span></code> É necessário para informar ao liquid que as linhas seguintes referem-se a parâmetros
do script. A partir deste ponto o liquidsoap já estará rodando e transmitindo a rádio através
das configurações do Icecast.</p>
</div>
<div class="section" id="arquivo-xml-de-configuracao-do-liquidsoap">
<h3>Arquivo XML de configuração do Liquidsoap<a class="headerlink" href="#arquivo-xml-de-configuracao-do-liquidsoap" title="Permalink to this headline">¶</a></h3>
<p>Para manter a compatibilidade com a versão inicial deste projeto foi implementado a bind dos atributos
presentes no arquivo de configuração XML dos clientes do autodj. O arquivo a seguir foi utilizado
para realizar os testes no servidor.</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;ices:Configuration xmlns:ices=&quot;http://www.icecast.org/projects/ices&quot;&gt;
  &lt;Playlist&gt;
    &lt;File&gt;/home/streaming/web/conf/8000-playlist-da-manha-teste.json&lt;/File&gt;
    &lt;Randomize&gt;1&lt;/Randomize&gt;
    &lt;Type&gt;builtin&lt;/Type&gt;
    &lt;Module&gt;ices&lt;/Module&gt;
  &lt;/Playlist&gt;
  &lt;Radio&gt;
      &lt;Name&gt;Default stream&lt;/Name&gt;
      &lt;Genre&gt;Default genre&lt;/Genre&gt;
      &lt;Description&gt;Default description&lt;/Description&gt;
      &lt;URL&gt;http://localhost/&lt;/URL&gt;
  &lt;/Radio&gt;
  &lt;Stream&gt;
    &lt;Server&gt;
      &lt;Hostname&gt;45.32.203.142&lt;/Hostname&gt;
      &lt;Port&gt;8000&lt;/Port&gt;
      &lt;User&gt;hackme&lt;/User&gt;
      &lt;Password&gt;hackme&lt;/Password&gt;
      &lt;Protocol&gt;http&lt;/Protocol&gt;
    &lt;/Server&gt;
    &lt;Mountpoint&gt;/live&lt;/Mountpoint&gt;
    &lt;fallback-mount&gt;/autodj&lt;/fallback-mount&gt;
    &lt;Shoucast&gt;
      &lt;shoutcast-mountpoint&gt;/live&lt;/shoutcast-mountpoint&gt;
      &lt;shoutcast-port&gt;8001&lt;/shoutcast-port&gt;
    &lt;/Shoucast&gt;
    &lt;Log&gt;
      &lt;Logfile&gt;true&lt;/Logfile&gt;
      &lt;Loglevel&gt;3&lt;/Loglevel&gt;
    &lt;/Log&gt;
    &lt;Audio&gt;
      &lt;Public&gt;0&lt;/Public&gt;
      &lt;Codec&gt;AAC&lt;/Codec&gt;
      &lt;Bitrate&gt;128&lt;/Bitrate&gt;
      &lt;Channels&gt;2&lt;/Channels&gt;
      &lt;Crossfade&gt;
        &lt;Fadein&gt;0.&lt;/Fadein&gt;
        &lt;Fadeout&gt;0.&lt;/Fadeout&gt;
        &lt;Startnext&gt;0.&lt;/Startnext&gt;
      &lt;/Crossfade&gt;
    &lt;/Audio&gt;
  &lt;/Stream&gt;
&lt;/ices:Configuration&gt;
</pre></div>
</div>
<p>Nem todos os atributos deste arquivo são utilizados pelo script do Liquidsoap, mas podem ser mantidos
como linguagem de marcação. Embora existam tags encadeadas como por exemplo : “&lt;Audio&gt;..&lt;/Audio&gt;”, as tags mais externas
não são consideradas pelo script, dessa forma apenas as tags com valor atribuido são processadas, como por exemplo “&lt;Fadein&gt;0&lt;/Fadein&gt;”.
Segue os atributos com suas descrições.</p>
<table border="1" class="colwidths-given docutils" id="id2">
<caption><span class="caption-text">Tabela de atributos obrigatórios Conf.xml</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Chave</th>
<th class="head">Observações</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&lt;Stream&gt;&lt;Server&gt;</td>
<td>X</td>
</tr>
<tr class="row-odd"><td>&lt;Mountpoint&gt;</td>
<td>Ponto de montagem principal</td>
</tr>
<tr class="row-even"><td>&lt;fallback-mount&gt;</td>
<td>Fallback do ponto principal (precisa ter uma segunda tag de &lt;mount&gt; setada no XML do icecast2)</td>
</tr>
<tr class="row-odd"><td>&lt;shoutcast-mountpoint&gt;</td>
<td>Ponto de montagem de conexão da live para o DJ</td>
</tr>
<tr class="row-even"><td>&lt;shoutcast-port&gt;</td>
<td>Porta para conexão do DJ. Não pode ser igual a porta do ponto de montagem</td>
</tr>
<tr class="row-odd"><td>&lt;Genre&gt;</td>
<td>X</td>
</tr>
<tr class="row-even"><td>&lt;Description&gt;</td>
<td>X</td>
</tr>
<tr class="row-odd"><td>&lt;Bitrate&gt;</td>
<td>96; 128; 192; 256 ou 320</td>
</tr>
<tr class="row-even"><td>&lt;Encode&gt;</td>
<td>MP3/AAC</td>
</tr>
<tr class="row-odd"><td>&lt;Playlist&gt;&lt;File&gt;</td>
<td>Caminho da playlist json; com os respectivos caminhos dos audios.</td>
</tr>
<tr class="row-even"><td>&lt;Logfile&gt;</td>
<td>TRUE ou FALSE</td>
</tr>
<tr class="row-odd"><td>&lt;Loglevel&gt;</td>
<td>Idica o nível de log desejado; intervalo entre 0 e 3</td>
</tr>
<tr class="row-even"><td>&lt;User&gt;</td>
<td>Usuário setado na config. do icecast2</td>
</tr>
<tr class="row-odd"><td>&lt;Password&gt;</td>
<td>Senha setada na config. do icecast2</td>
</tr>
<tr class="row-even"><td>&lt;Crossfade&gt;&lt;Fadein&gt;</td>
<td>(float) Tempo do fade incial</td>
</tr>
<tr class="row-odd"><td>&lt;Crossfade&gt;&lt;Fadeout&gt;</td>
<td>(float) Tempo do fade final</td>
</tr>
<tr class="row-even"><td>&lt;Crossfade&gt;&lt;Startnext&gt;</td>
<td>(float) Ponto do audio que o fade inicia</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="arquivo-xml-de-configuracao-exemplo-icecast2">
<h3>Arquivo XML de configuração exemplo Icecast2<a class="headerlink" href="#arquivo-xml-de-configuracao-exemplo-icecast2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>&lt;icecast&gt;
    &lt;location&gt;Maringa&lt;/location&gt;
    &lt;admin&gt;suporte@livecast.com.br&lt;/admin&gt;
    &lt;limits&gt;
        &lt;clients&gt;99999&lt;/clients&gt;
        &lt;sources&gt;2&lt;/sources&gt;
        &lt;queue-size&gt;524288&lt;/queue-size&gt;
        &lt;client-timeout&gt;30&lt;/client-timeout&gt;
        &lt;header-timeout&gt;15&lt;/header-timeout&gt;
        &lt;source-timeout&gt;10&lt;/source-timeout&gt;
        &lt;burst-size&gt;65535&lt;/burst-size&gt;
    &lt;/limits&gt;
    &lt;authentication&gt;
        &lt;source-password&gt;hackme&lt;/source-password&gt;
        &lt;relay-password&gt;hackme&lt;/relay-password&gt;
        &lt;admin-user&gt;source&lt;/admin-user&gt;
        &lt;admin-password&gt;hackme&lt;/admin-password&gt;
    &lt;/authentication&gt;
    &lt;hostname&gt;192.168.15.10&lt;/hostname&gt;
    &lt;listen-socket&gt;
        &lt;port&gt;8000&lt;/port&gt;
    &lt;/listen-socket&gt;
    &lt;mount type=&quot;normal&quot;&gt;
        &lt;mount-name&gt;/autodj&lt;/mount-name&gt;
        &lt;charset&gt;UTF8&lt;/charset&gt;
    &lt;/mount&gt;
    &lt;mount type=&quot;normal&quot;&gt;
        &lt;mount-name&gt;/live&lt;/mount-name&gt;
        &lt;charset&gt;UTF8&lt;/charset&gt;
    &lt;/mount&gt;
    &lt;fileserve&gt;1&lt;/fileserve&gt;
    &lt;paths&gt;
        &lt;basedir&gt;/usr/local/share/icecast&lt;/basedir&gt;
        &lt;webroot&gt;/usr/local/share/icecast/web&lt;/webroot&gt;
        &lt;adminroot&gt;/usr/local/share/icecast/admin&lt;/adminroot&gt;
        &lt;logdir&gt;/home/streaming/configs/8000&lt;/logdir&gt;
        &lt;pidfile&gt;/home/streaming/configs/8000/icecast.pid&lt;/pidfile&gt;
        &lt;alias source=&quot;/&quot; dest=&quot;/status.xsl&quot;/&gt;
    &lt;/paths&gt;
    &lt;logging&gt;
        &lt;accesslog&gt;access8000.log&lt;/accesslog&gt;
        &lt;errorlog&gt;error8000.log&lt;/errorlog&gt;
        &lt;loglevel&gt;3&lt;/loglevel&gt;
        &lt;logsize&gt;10000&lt;/logsize&gt;
    &lt;/logging&gt;
    &lt;security&gt;
        &lt;chroot&gt;0&lt;/chroot&gt;
        &lt;changeowner&gt;
            &lt;user&gt;icecast2&lt;/user&gt;
            &lt;group&gt;icecast&lt;/group&gt;
        &lt;/changeowner&gt;
    &lt;/security&gt;
&lt;/icecast&gt;
</pre></div>
</div>
</div>
<div class="section" id="arquivo-json-da-playlist">
<h3>Arquivo JSON da playlist<a class="headerlink" href="#arquivo-json-da-playlist" title="Permalink to this headline">¶</a></h3>
<p>Para que os scripts funcionem corretamente o arquivo JSON de configuração
de playlist deve obrigatóriamente conter os seguintes atributos.:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>{
    &quot;settings&quot;: {
        &quot;play&quot;: &quot;random&quot;,
        &quot;total&quot;: 19,
        &quot;last-update&quot;: 1533747126
    },
    &quot;playlists&quot;: {
        &quot;original&quot;: [
            {
                &quot;playlist_name&quot;: &quot;playlist da manha teste&quot;,
                &quot;user_port&quot;: &quot;8000&quot;,
                &quot;music_name&quot;: &quot;televar&quot;,
                &quot;duration&quot;: &quot;00:04:25&quot;,
                &quot;type&quot;: &quot;musica&quot;,
                &quot;total_musica&quot;: 19,
                &quot;music_location&quot;: &quot;\/home\/streaming\/web\/music\/musics\/&quot;,
                &quot;total_duracao&quot;: &quot;02:45:15&quot;
            }
        ],
        &quot;playing&quot;: {
            &quot;status&quot;: {
                &quot;current-music&quot;: ...
            },
            &quot;musics&quot;: [...]
        }
    }
}
</pre></div>
</div>
<table border="1" class="colwidths-given docutils" id="id3">
<caption><span class="caption-text">Tabela de atributos obrigatórios Playlist.json</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Chave</th>
<th class="head">Valor</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>settings.play</td>
<td>sequencial / random</td>
</tr>
<tr class="row-odd"><td>settings.total</td>
<td>total de músicas da playlist</td>
</tr>
<tr class="row-even"><td>settings.last-update</td>
<td>Preenchido pelo Sistema</td>
</tr>
<tr class="row-odd"><td>playlists.original[].playlist_name</td>
<td>Nome da playlist</td>
</tr>
<tr class="row-even"><td>playlists.original[].user_port</td>
<td>Porta</td>
</tr>
<tr class="row-odd"><td>playlists.original[].music_name</td>
<td>Nome da Música</td>
</tr>
<tr class="row-even"><td>playlists.original[].duration</td>
<td>Duração</td>
</tr>
<tr class="row-odd"><td>playlists.original[].type</td>
<td>musica / hora_certa</td>
</tr>
<tr class="row-even"><td>playlists.original[].total_musica</td>
<td>Total de músicas</td>
</tr>
<tr class="row-odd"><td>playlists.original[].music_location</td>
<td>Caminho absoluto da pasta</td>
</tr>
<tr class="row-even"><td>playlists.original[].total_duracao</td>
<td>Duração playlist</td>
</tr>
<tr class="row-odd"><td>playing</td>
<td>Todos são preenchidos pelo Sistema</td>
</tr>
<tr class="row-even"><td>playing.status.current-music</td>
<td>Indice da música atual</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="scripts-para-manipulacao-da-playlist">
<h3>Scripts para Manipulação da Playlist<a class="headerlink" href="#scripts-para-manipulacao-da-playlist" title="Permalink to this headline">¶</a></h3>
<p>Os scripts desenvolvidos que manipulam as playlists do autodj assim como
a playlist estão em sua maioria localizados na pasta <code class="docutils literal notranslate"><span class="pre">app/service</span></code> e são utilizados
em sua maioria como <code class="docutils literal notranslate"><span class="pre">$php</span> <span class="pre">+</span> <span class="pre">_nome-do-script</span></code>.</p>
<table border="1" class="colwidths-given docutils" id="id4">
<caption><span class="caption-text">Tabela de Scripts que permitem chamadas externas</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Script</th>
<th class="head">Descrição</th>
<th class="head">Parametro(s)</th>
<th class="head">Response</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>app/service/get_newsong.php</td>
<td>Pula uma música</td>
<td>Mountpoint (cli)</td>
<td>X</td>
</tr>
<tr class="row-odd"><td>app/service/playlist_stop.php</td>
<td>Para a playlist em execução</td>
<td>Porta de execução (cli)</td>
<td>FALSE se ERROR</td>
</tr>
<tr class="row-even"><td>app/service/playlist_status.php</td>
<td>Status das músicas da playlist</td>
<td>Pid Liquid (cli)</td>
<td>JSON</td>
</tr>
<tr class="row-odd"><td>app/service/playlist_next_song.php</td>
<td>Pula música sem esperar o fim da execução (cli)</td>
<td>Porta de execução</td>
<td>FALSE se ERROR</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="instalacao-do-liquidsoap-com-encoders">
<h2>Instalação do Liquidsoap com Encoders<a class="headerlink" href="#instalacao-do-liquidsoap-com-encoders" title="Permalink to this headline">¶</a></h2>
<p>A aplicação assim como as dependências do liquidsoap são gerenciadas
através do Package Manager Opam. Não instale o OPAM nem suas dependências
como <cite>root</cite>, utilize o usuário que será usado para execução do S.O .</p>
<p>1. Instalação do opam:
<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">update</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">opam</span></code></p>
<p>Em seguida:
<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">opam</span> <span class="pre">init</span> <span class="pre">&amp;&amp;</span> <span class="pre">eval</span> <span class="pre">`opam</span> <span class="pre">config</span> <span class="pre">env`</span></code></p>
<ol class="arabic simple" start="2">
<li>Instalação do Liquidsoap</li>
</ol>
<p>Verifique as dependências necessárioas através do plugin depext:
<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">opam</span> <span class="pre">install</span> <span class="pre">depext</span> <span class="pre">&amp;&amp;</span> <span class="pre">opam</span> <span class="pre">depext</span> <span class="pre">taglib</span> <span class="pre">mad</span> <span class="pre">lame</span> <span class="pre">vorbis</span> <span class="pre">cry</span> <span class="pre">ssl</span> <span class="pre">samplerate</span> <span class="pre">magic</span> <span class="pre">opus</span> <span class="pre">liquidsoap</span></code></p>
<p>Para instalar: <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">opam</span> <span class="pre">install</span> <span class="pre">taglib</span> <span class="pre">mad</span> <span class="pre">lame</span> <span class="pre">vorbis</span> <span class="pre">cry</span> <span class="pre">ssl</span> <span class="pre">samplerate</span> <span class="pre">magic</span> <span class="pre">opus</span> <span class="pre">liquidsoap</span></code></p>
<p>3. Instalação dos pacotes de codificação para os principais formatos diferentes de MP3
<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">opam</span> <span class="pre">depext</span> <span class="pre">fdkaac</span> <span class="pre">&amp;&amp;</span> <span class="pre">opam</span> <span class="pre">install</span> <span class="pre">fdkaac</span></code></p>
</div>
<div class="section" id="dependencias-do-servidor">
<h2>Dependências do Servidor<a class="headerlink" href="#dependencias-do-servidor" title="Permalink to this headline">¶</a></h2>
<p>As deste projeto podem ser instaladas com o seguinte comando:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">icecast2</span> <span class="pre">git</span> <span class="pre">python</span> <span class="pre">python-dev</span> <span class="pre">apache2</span> <span class="pre">php</span> <span class="pre">php-xml</span> <span class="pre">php-simplexml</span> <span class="pre">php-mysql</span>
<span class="pre">mysql-server</span> <span class="pre">opam</span></code></p>
</div>
<div class="section" id="script-de-instalacao">
<h2>Script de Instalação<a class="headerlink" href="#script-de-instalacao" title="Permalink to this headline">¶</a></h2>
<p>O script de instalação foi desenvolvido para automatizar e auxiliar na instalação
das ferramentas desta documentação e pode ser encontrado em .:</p>
<p><a class="reference external" href="https://gitlab.com/rafaelbaiolim1/liquidsoap/tree/install">https://gitlab.com/rafaelbaiolim1/liquidsoap/tree/install</a></p>
</div>
</div>
<div class="section" id="observacoes-pertinentes">
<h1>Observações Pertinentes<a class="headerlink" href="#observacoes-pertinentes" title="Permalink to this headline">¶</a></h1>
<p>De preferência a usar caminhos absolutos para referenciar o caminho dos arquivos,
tanto no arquivo JSON quanto nos parâmetros de script.</p>
</div>
<div class="section" id="solucoes-conhecidas">
<h1>Soluções Conhecidas<a class="headerlink" href="#solucoes-conhecidas" title="Permalink to this headline">¶</a></h1>
<div class="section" id="problema-de-leitura-dos-arquivos-xml">
<h2>Problema de Leitura dos Arquivos XML<a class="headerlink" href="#problema-de-leitura-dos-arquivos-xml" title="Permalink to this headline">¶</a></h2>
<p><em>solução&gt;</em> <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">777</span> <span class="pre">-R</span> <span class="pre">/home/streaming/configs/</span></code></p>
</div>
<div class="section" id="falta-de-memoria-no-servidor-para-instalcao-do-opam">
<h2>Falta de memória no servidor para instalção do OPAM<a class="headerlink" href="#falta-de-memoria-no-servidor-para-instalcao-do-opam" title="Permalink to this headline">¶</a></h2>
<p><em>solução&gt;</em> Crie um arquivo de swap temporário com os seguintes comandos:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">dd</span> <span class="pre">if=/dev/zero</span> <span class="pre">of=/swapfile1</span> <span class="pre">bs=1024</span> <span class="pre">count=524288</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">mkswap</span> <span class="pre">/swapfile1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chown</span> <span class="pre">root:root</span> <span class="pre">/swapfile1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">0600</span> <span class="pre">/swapfile1</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">swapon</span> <span class="pre">/swapfile1</span></code></li>
</ol>
<p>Lembrando que se isso ocorrer ao realizar o login será necessário atualizar
as variavéis de ambiente para o opam ser reconhecido, use o comando a seguir:</p>
<p><code class="docutils literal notranslate"><span class="pre">eval</span> <span class="pre">`opam</span> <span class="pre">config</span> <span class="pre">env`</span> <span class="pre">&amp;&amp;</span> <span class="pre">source</span> <span class="pre">~/.profile</span></code></p>
</div>
<div class="section" id="grupo-de-usuario-sem-permissao-no-liquidsoap">
<h2>Grupo de usuário sem permissão no Liquidsoap<a class="headerlink" href="#grupo-de-usuario-sem-permissao-no-liquidsoap" title="Permalink to this headline">¶</a></h2>
<p><em>solução&gt;</em> Verifique no <code class="docutils literal notranslate"><span class="pre">xml</span> <span class="pre">de</span> <span class="pre">configuração</span> <span class="pre">do</span> <span class="pre">icecast2</span></code> se existe a seguinte chave:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span>&lt;security&gt;
    &lt;chroot&gt;0&lt;/chroot&gt;
    &lt;changeowner&gt;
        &lt;user&gt;icecast2&lt;/user&gt;
        &lt;group&gt;icecast&lt;/group&gt;
    &lt;/changeowner&gt;
&lt;/security&gt;
</pre></div>
</div>
</div>
<div class="section" id="habilitar-conexao-remota-mysql">
<h2>Habilitar Conexão Remota MYSQL<a class="headerlink" href="#habilitar-conexao-remota-mysql" title="Permalink to this headline">¶</a></h2>
<p><em>solução&gt;</em></p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">$mysql</span> <span class="pre">-u</span> <span class="pre">root</span> <span class="pre">-p</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">GRANT</span> <span class="pre">ALL</span> <span class="pre">PRIVILEGES</span> <span class="pre">ON</span> <span class="pre">*.*</span> <span class="pre">TO</span> <span class="pre">'root'&#64;'%'</span> <span class="pre">IDENTIFIED</span> <span class="pre">BY</span> <span class="pre">'SENHA_DO_ROOT'</span> <span class="pre">WITH</span> <span class="pre">GRANT</span> <span class="pre">OPTION;</span> <span class="pre">FLUSH</span> <span class="pre">PRIVILEGES;</span></code></li>
<li>Edite o arquivo: <code class="docutils literal notranslate"><span class="pre">/etc/mysql/mysql.conf.d/mysqld.cnf</span></code>&gt; #bind-address = 127.0.0.1</li>
<li><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">mysql</span> <span class="pre">restart</span></code></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Rafael Baiolim.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'pt-br',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>